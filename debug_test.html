<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - PHP Mailer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 20px 0; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug Test - PHP Mailer</h1>
        
        <div class="debug-section">
            <h2>Krok 1: Kontrola prost≈ôed√≠</h2>
            <button onclick="checkEnvironment()">Zkontrolovat prost≈ôed√≠</button>
            <div id="envResult"></div>
        </div>

        <div class="debug-section">
            <h2>Krok 2: Test formul√°≈ôe</h2>
            <form id="debugForm">
                <label>Organizace:</label>
                <input type="text" name="company" value="Test s.r.o." required>
                
                <label>Kontaktn√≠ osoba:</label>
                <input type="text" name="contact-name" value="Jan Nov√°k" required>
                
                <label>E-mail:</label>
                <input type="email" name="email" value="test@example.com" required>
                
                <label>Telefon:</label>
                <input type="tel" name="phone" value="+420123456789" required>
                
                <label>Poƒçet √∫ƒçastn√≠k≈Ø:</label>
                <input type="number" name="participants" value="10" required>
                
                <label>Semin√°≈ô:</label>
                <select name="seminar" required>
                    <option value="ai-beginners">AI I. - pro zaƒç√°teƒçn√≠ky</option>
                    <option value="ai-intermediate">AI II. - pro m√≠rnƒõ pokroƒçil√©</option>
                    <option value="legislativa-dokumenty">Souƒçasn√° legislativa</option>
                </select>
                
                <label>Zpr√°va:</label>
                <textarea name="message" rows="3">Toto je testovac√≠ zpr√°va pro debug √∫ƒçely.</textarea>
                
                <button type="button" onclick="testForm()">Test formul√°≈ôe (Debug)</button>
                <button type="button" onclick="testRealForm()">Test skuteƒçn√©ho maileru</button>
            </form>
            <div id="formResult"></div>
        </div>

        <div class="debug-section">
            <h2>Krok 3: Detailn√≠ logy</h2>
            <button onclick="showLogs()">Zobrazit console logy</button>
            <div id="consoleResult"></div>
        </div>
    </div>

    <script>
        let consoleMessages = [];
        
        // Zachyt√≠me console logy
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            consoleMessages.push({ type: 'log', message: args.join(' '), time: new Date().toISOString() });
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            consoleMessages.push({ type: 'error', message: args.join(' '), time: new Date().toISOString() });
            originalError.apply(console, args);
        };

        async function checkEnvironment() {
            const result = document.getElementById('envResult');
            result.innerHTML = '<p>Kontroluji prost≈ôed√≠...</p>';
            
            try {
                const response = await fetch('debug_mailer.php?action=check');
                const data = await response.json();
                
                let html = '<h3>V√Ωsledky kontroly:</h3><pre>' + JSON.stringify(data.debug, null, 2) + '</pre>';
                
                if (data.debug.files_exist['send_email.php']) {
                    html += '<p class="success">‚úÖ send_email.php existuje</p>';
                } else {
                    html += '<p class="error">‚ùå send_email.php neexistuje!</p>';
                }
                
                if (data.debug.files_exist['vendor/autoload.php']) {
                    html += '<p class="success">‚úÖ PHPMailer je nainstalov√°n</p>';
                } else {
                    html += '<p class="error">‚ùå PHPMailer nen√≠ nainstalov√°n! Spus≈•te: composer install</p>';
                }
                
                if (data.debug.config && data.debug.config.is_default_config) {
                    html += '<p class="warning">‚ö†Ô∏è Pou≈æ√≠v√°te v√Ωchoz√≠ konfiguraci - nastavte spr√°vn√© SMTP √∫daje!</p>';
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = '<p class="error">Chyba p≈ôi kontrole prost≈ôed√≠: ' + error.message + '</p>';
                console.error('Environment check error:', error);
            }
        }

        async function testForm() {
            const form = document.getElementById('debugForm');
            const result = document.getElementById('formResult');
            result.innerHTML = '<p>Testuji formul√°≈ô...</p>';
            
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => { data[key] = value; });
            
            console.log('Odes√≠l√°m testovac√≠ data:', data);
            
            try {
                const response = await fetch('debug_mailer.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                console.log('Response status:', response.status);
                const responseData = await response.json();
                console.log('Response data:', responseData);
                
                let html = '<h3>V√Ωsledek testu formul√°≈ôe:</h3>';
                if (responseData.success) {
                    html += '<p class="success">‚úÖ ' + responseData.message + '</p>';
                } else {
                    html += '<p class="error">‚ùå ' + responseData.message + '</p>';
                }
                
                html += '<h4>Debug informace:</h4><pre>' + JSON.stringify(responseData.debug, null, 2) + '</pre>';
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = '<p class="error">Chyba p≈ôi testu formul√°≈ôe: ' + error.message + '</p>';
                console.error('Form test error:', error);
            }
        }

        async function testRealForm() {
            const form = document.getElementById('debugForm');
            const result = document.getElementById('formResult');
            result.innerHTML = '<p>Testuji skuteƒçn√Ω mailer...</p>';
            
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => { data[key] = value; });
            
            console.log('Testuji skuteƒçn√Ω mailer s daty:', data);
            
            try {
                const response = await fetch('send_email.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                console.log('Real mailer response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const responseData = await response.json();
                console.log('Real mailer response data:', responseData);
                
                let html = '<h3>V√Ωsledek skuteƒçn√©ho maileru:</h3>';
                if (responseData.success) {
                    html += '<p class="success">‚úÖ ' + responseData.message + '</p>';
                    html += '<p><strong>Email byl odesl√°n!</strong></p>';
                } else {
                    html += '<p class="error">‚ùå ' + responseData.message + '</p>';
                    if (responseData.debug) {
                        html += '<h4>Debug informace:</h4><pre>' + JSON.stringify(responseData.debug, null, 2) + '</pre>';
                    }
                }
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = '<p class="error">Chyba p≈ôi testu skuteƒçn√©ho maileru: ' + error.message + '</p>';
                console.error('Real mailer test error:', error);
            }
        }

        function showLogs() {
            const result = document.getElementById('consoleResult');
            let html = '<h3>Console logy:</h3>';
            
            if (consoleMessages.length === 0) {
                html += '<p>≈Ω√°dn√© logy zat√≠m nejsou k dispozici.</p>';
            } else {
                consoleMessages.forEach(msg => {
                    const className = msg.type === 'error' ? 'error' : 'success';
                    html += `<p class="${className}">[${msg.time}] ${msg.type.toUpperCase()}: ${msg.message}</p>`;
                });
            }
            
            result.innerHTML = html;
        }

        // Automatick√° kontrola p≈ôi naƒçten√≠ str√°nky
        window.addEventListener('load', () => {
            checkEnvironment();
        });
    </script>
</body>
</html>